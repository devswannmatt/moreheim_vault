<form id="create-member-form" method="POST" action="/members/create">
    <div class="row">
        <div class="col s6">
            <div class="input-field">
                <select id="warband" name="warband" required>
                    {{#each warbands}}
                    <option value="{{this._id}}" {{#if this.selected}}selected{{else}} disabled{{/if}}>{{this.name}}</option>
                    {{/each}}
                </select>
                <label for="warband">Warband</label>
            </div>
        </div>
        <div class="col s6">
            <div class="input-field">
                <select id="roster" name="roster" required>
                    <option value="" disabled selected>Choose roster</option>
                    {{#each rosters}}
                    <option value="{{this._id}}" {{#if this.selected}}selected{{else}} disabled{{/if}}>{{this.name}}</option>
                    {{/each}}
                </select>
                <label for="roster">Roster</label>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col s12">
            <div class="input-field">
                <input id="name" name="name" type="text" required>
                <label for="name">Name</label>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col s8">
            <div class="input-field">
                <select id="unit" name="unit" required>
                    <option value="" disabled selected>Choose unit</option>
                    {{#each units}}
                    <option value="{{this._id}}" data-gold="{{this.gold}}">{{formatUnitType this.type}} {{this.name}} {{this.gold}}g</option>
                    {{/each}}
                </select>
                <label for="unit">Unit</label>
            </div>
        </div>
        <div class="col s2">
            <div class="input-field">
                <input class="derived-field" id="qty" name="qty" type="number" value="1" min="1" data-derived-field="unittype=1" required>
                <label for="qty">Quantity</label>
            </div>
        </div>
        <div class="col s2">
            <div class="input-field">
                <input id="cost" name="cost" type="number" value="{{member.cost}}" min="1" required>
                <label for="cost" class="active">Cost</label>
            </div>
        </div>
    </div>

    <button class="btn waves-effect waves-light" type="submit">Create Member</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        
        var fields = document.querySelectorAll('.derived-field');

        var elems = document.querySelectorAll('select');
        var instances = M.FormSelect.init(elems);

        // Update cost based on selected unit and quantity
        const unitSelect = document.getElementById('unit');
        const qtyInput = document.getElementById('qty');
        const costInput = document.getElementById('cost');

        function updateCost() {
            const selectedOption = unitSelect.options[unitSelect.selectedIndex];
            const unitGold = parseInt(selectedOption.getAttribute('data-gold')) || 0;
            const quantity = parseInt(qtyInput.value) || 1;
            costInput.value = unitGold * quantity;
            M.updateTextFields(); // Update labels
        }

        unitSelect.addEventListener('change', updateCost);
        qtyInput.addEventListener('input', updateCost);
    });
</script>